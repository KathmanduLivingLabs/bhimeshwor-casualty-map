---
layout: iframe_default
---

<!-- Fallback info -->
<!--     <div class="rowDOE fallback">
      <div class="large-12 columnsDOE" style="background-color: #fbedc2; height:40px; padding-top:11px;">
        <center>Want to view this interactive graphic in all its glory? Upgrade to a modern browser!</center>
      </div>
    </div>
    <div class="fallback">
      <img src="img/consumption_fallback.jpg">
    </div> -->
           

            <!-- <select id="mySelect"></select> -->
  <div id="master_container" class="m_container">        

    <div class="rowDOE">
      <!-- <div class="large-12 columnsDOE headline">
        <center><h2>Mapping the casualties of the <span class="color-text">earthquake</span> in Nepal</h2></center>
      </div> -->
      <!-- <div class="large-12 columnsDOE subheadline">
        <p> Hover over each district to see how it was affected.</p>
      </div> -->      
      <div class="large-4 medium-4 small-4 rowDOE topinfo">
        <div class="large-6 medium-6 small-6 columnsDOE large-centered medium-centered small-centered">
          <div id="deathmap" class="large-6 medium-6 small-6 nepbuttons active"><p>Deaths</p></div>
          <div id="injurymap" class="large-6 medium-6 small-6 nepbuttons"><p>Injuries</p></div>
        </div>
      </div>
    </div>
    <div class="rowDOE" id="map">      
      <div id="totalinfo" class="large-4 medium-4 small-4 rowDOE topinfo">
        <p>As of <span class="date">April 29, 2015 1105 NST</span></p>
        <h1>Total Deaths: 5,006</h1>
        <h1>Total Injuries: 10,194</h1>
      </div>
      <div class="contextinfo">
        <p>Data Updated: April 29, 2015 1105 NST</p>
        <p>Source: Nepal National Information Technology Center. Download the data <a href="https://docs.google.com/spreadsheets/d/1Q3QSx1_p78T4_qo_JVj5vEQtzuCFWP2AfxYnVBSNzLQ/pubhtml">here</a>. </p>
        <!-- <p>Produced by <a href="http://kathmandulivinglabs.org/">Kathmandu Living Labs</a>.</p> -->
      </div>
    </div>
    <!-- <div class="rowDOE contextinfo">
      <p>Data Updated: April 28, 2015 0700 hrs</p>
      <p>Source: Nepal National Information Technology Center. Download the data <a href="https://docs.google.com/spreadsheets/d/1Q3QSx1_p78T4_qo_JVj5vEQtzuCFWP2AfxYnVBSNzLQ/pubhtml">here</a>. </p>
    </div> -->

</div>    
<!DOCTYPE html>
<meta charset="utf-8">
<style>
#map {
  position: relative;
  /*top: 0px;*/
  z-index: 1000;
  margin: 0 auto;
}

.districts_id {
  fill:none;
}
/*
svg {
  fill: #d3d3d3;
}*/

.states {
  fill: none;
  /*stroke: #fff;*/
  stroke-width: 0.5px;
  stroke: #d3d3d3;
  stroke-linejoin: round;

}

.country {
  fill: none;
  /*stroke: #fff;*/
  stroke-width: 2px;
  stroke: #FFE8D5;
  stroke-linejoin: round;

}

.q0 {fill:#FFFFFF} 
.q1 {fill:#FFE8D5} 
.q2 {fill:#FFD1AB} 
.q3 {fill:#FFBB81} 
.q4 {fill:#FF7D5A} 
.q5 {fill:#FF4033} 
.q6 {fill:#FF030D}

.graticule {
  fill: #d3d3d3;
  stroke: #FF030D;
  stroke-opacity:0.5;
  stroke-width: 0.5px;
}
</style>
<body>
<script src="js/d3.js"></script>
<script src="js/query.js"></script>
<script src="js/geoprojections.js"></script>
<script src="js/topojson.js"></script>

<script>

var width = 650,
    height = 285;

var tipWidth = 150,
    tipHeight = 70;

// Ramp paraemters, first for dead, then for injuries
var rampameters = [[0,10,50,100,500,1000,2000],[0,10,50,100,500,1000,4000]]

//m = 0 is dead map, m = 1 is injured map;
var m = 0;

// define the color ramp function
var ramp = function(d, m) {
  if (m === 0) {
    var o = d.properties.dead;
  } else if (m === 1) {
    var o = d.properties.injured;
  };
  
  for (var i = 0; i < rampameters[m].length; i++) {
    if (o <= rampameters[m][i]) {
      var qclass = "q" + i;
      break;
    };
  };
  return qclass;
}

// var projection = d3.geo.albers()
//     .scale(1280)
//     .translate([width / 2, height / 2]);

// var scale = 5750;
// var yaw = -84.5;
// var pitch = 11.1 ;
// var roll = 0;
var scale = 3750;
var yaw = -87;
var pitch = 12.1 ;
var roll = 0;
var graticulex = 1;
var graticuley = 1; 

var projection = d3.geo.albers()
  .scale(scale)    
  .rotate([yaw, pitch, roll]) //yaw, pitch, roll    ;  

var graticule = d3.geo.graticule()
  .step([graticulex, graticuley]);

var path = d3.geo.path()
    .projection(projection);

var svg = d3.select("body").select("#map").append("svg")
    .attr("width", width)
    .attr("height", height);

svg.append("path")
  .datum(graticule)
  .attr("class", "graticule")
  .attr("d", path);
  
queue()
    .defer(d3.json, "data/districts_topo4.json")    
    .await(ready);

function ready(error, districts_topo4) {
console.log(districts_topo4)
  svg.append("g")
      .attr("class", "districts_id")
    .selectAll("path")
      .data(topojson.feature(districts_topo4, districts_topo4.objects.districts_id).features)
    .enter().append("path")
      .attr("class", function(d) { 
        return ramp(d,m)
        // return quantize(rateById.get(d.id)); 
      })
      .attr("d", path)
      .on("mouseover", tooltip)
      .on("mouseout", remover);

// Draw the state borders
  svg.append("path")
      .datum(topojson.mesh(districts_topo4, districts_topo4.objects.districts_id, function(a, b) { 
        return a !== b; }))
      .attr("class", "states")
      .attr("d", path)

    svg.append("path")
      .datum(topojson.mesh(districts_topo4, districts_topo4.objects.districts_id, function(a, b) { 
        return a == b; }))
      .attr("class", "country")
      .attr("d", path)      
}

function tooltip(d) {
  var dead = d.properties.dead;
  var injured = d.properties.injured;
  var district = d.properties.district;

  centroid = path.centroid(d);

  centroid_adjusted = [(centroid[0]-(tipHeight)),(centroid[1]-(tipWidth-50))];

        // tip_text  = [(centroid_adjusted[0] -50),(centroid_adjusted[1])];
        tip_text = [(centroid_adjusted[0] + (tipWidth /2)),(centroid_adjusted[1] + 20)];
        tip_text2  = [(centroid_adjusted[0] + (tipWidth /2)),(centroid_adjusted[1] + 40)];
        tip_text3  = [(centroid_adjusted[0] + (tipWidth /2)),(centroid_adjusted[1] + 60)];
        
      var tooltipContainer = svg.append("g")
        .attr("id", "tooltip")
      .append("rect")
              .attr("transform", function() { 
          return "translate(" + centroid_adjusted + ")"; })
        .attr("width", (tipWidth))
        .attr("height", (tipHeight))
        .attr("rx", 6)
        .attr("ry", 6)
        // .attr("fill", "brown");

// tip title
      svg
        .append("text")
        .attr("class","tip-text")
        .text(function(d){return district})
        .attr("transform", function() { 
          return "translate(" + tip_text + ")"; });

      svg
        .append("text")
        .attr("class","tip-text2")
        .text(function(d){
            return "Total dead: " + dead;
        })
        .attr("transform", function() { 
          return "translate(" + tip_text2 + ")"; });
        
        svg
        .append("text")
        .attr("class","tip-text3")
        .text(function(d){
            return "Total injuries: " + injured;
        })
        .attr("transform", function() { 
          return "translate(" + tip_text3 + ")"; });           
}      
// d3.selectAll("g").on('mouseover', tooltip);

function remover() {
      d3.select("#tooltip").remove();
      d3.selectAll(".tip-text").remove();
      d3.selectAll(".tip-text2").remove();        
      d3.selectAll(".tip-text3").remove();     
    }


// WHAT YOU DO WHEN YOU CLICK TO CHANGE THE MAP
var deathmap = document.getElementById("deathmap");
var injurymap = document.getElementById("injurymap");

deathmap.onmousedown = function () {
  if (m === 1) {
      deathmap.className = "large-6 medium-6 small-6 nepbuttons active"
      injurymap.className = "large-6 medium-6 small-6 nepbuttons"
      m-=1;
      // d3.selectAll('g').data([]).exit().remove();
      d3.selectAll(".districts_id").remove();
      d3.selectAll(".country").remove();
      d3.selectAll(".states").remove();
    queue()
      .defer(d3.json, "data/districts_topo4.json")
      .await(ready);
  };    
};

injurymap.onmousedown = function () {
    if (m === 0) {
      deathmap.className = "large-6 medium-6 small-6  nepbuttons"
      injurymap.className = "large-6 medium-6 small-6 nepbuttons active"
      m+=1;
      // d3.selectAll('g').data([]).exit().remove();
      d3.selectAll(".districts_id").remove();
      d3.selectAll(".country").remove();
      d3.selectAll(".states").remove();
    queue()
      .defer(d3.json, "data/districts_topo4.json")
      .await(ready);
    };
};

d3.select(self.frameElement).style("height", height + "px");



</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-48744808-4', 'auto');
  ga('send', 'pageview');

</script>